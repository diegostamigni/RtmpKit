#
#  CMakeLists.txt
#  RtmpKit
#
#  Created by Diego Stamigni on 11/08/2016.
#  Copyright Â© 2016 Diego Stamigni. All rights reserved.
#

cmake_minimum_required(VERSION 3.5)
include(GenerateExportHeader)

project(rtmpkit)
include(Sources.cmake)

if ("${LIB_VERSION}" STREQUAL "")
    set(LIB_VERSION "0.0.0")
endif()

string(TOUPPER "${PROJECT_NAME}_VERSION" VERSION_FILE_STR_NAME)
file(WRITE include/version.h
    "// AUTOGENERATED FROM CMAKE\n\#define ${VERSION_FILE_STR_NAME} \"${LIB_VERSION}\"\n"
)

# build-type by default is `Debug' if not set
if ("${CMAKE_BUILD_TYPE}" STREQUAL "")
    message ("CMAKE_BUILD_TYPE is not set, using the default `Debug' value")
    set(CMAKE_BUILD_TYPE Debug)
else()
    message ("Using CMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE}")
endif()

# handling async sockets
if ("${ENABLE_ASYNC_SOCKET_READ_WRITE}" STREQUAL "")
    message ("ENABLE_ASYNC_SOCKET_READ_WRITE is not set, using the default `false' value")
    set(ENABLE_ASYNC_SOCKET_READ_WRITE false)
else()
    message ("Using ENABLE_ASYNC_SOCKET_READ_WRITE=${CMAKE_BUILD_TYPE}")
endif()

if(ANDROID)
    include(PlatformAndroid.cmake)
else()
    include(PlatformGeneric.cmake)
endif()

if (NOT "${CURRENT_TARGET_TYPE}" STREQUAL "")
    set(CMAKE_CXX_FLAGS_DEBUG "${CMAKE_CXX_FLAGS_DEBUG} -D${CURRENT_TARGET_TYPE} -DENABLE_ASYNC_SOCKET_READ_WRITE=${ENABLE_ASYNC_SOCKET_READ_WRITE} -DDEBUG -DLOG_VERBOSE")
    set(CMAKE_CXX_FLAGS_RELEASE "${CMAKE_CXX_FLAGS_RELEASE} -D${CURRENT_TARGET_TYPE} -DENABLE_ASYNC_SOCKET_READ_WRITE=${ENABLE_ASYNC_SOCKET_READ_WRITE} -DNDEBUG")
endif()

if ("${CMAKE_BUILD_TYPE}" STREQUAL "Debug")
	set(CMAKE_VERBOSE_MAKEFILE ON)
else()
	set(CMAKE_VERBOSE_MAKEFILE OFF)
endif()
